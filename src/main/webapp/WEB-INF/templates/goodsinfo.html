<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>海盗商品详情页</title>
    <link rel="stylesheet" th:href="@{/static/css/main.css}">
    <link rel="stylesheet" th:href="@{/static/css/reset.css}">
    <script type="text/javascript" th:src="@{/static/js/jquery.min.js}"></script>
    <script th:src="@{/static/js/bootstrap.min.js}"></script>
</head>
<body>

<!-- 头部信息 -->
<div class="header_con">
    <div class="header">
        <div class="welcome">欢迎来到海盗商城 !</div>
        <div class="user_login">
            <a th:href="@{/}">登录</a>
            <span>|</span>
            <a th:href="@{/rejisUser}">注册</a>
            <span>|</span>
            <a th:href="@{/cart}">我的购物车</a>
            <span>|</span>
            <a th:href="@{/orders}">我的订单</a>
        </div>
    </div>
</div>
<div class="search_bar clearfix">
    <a href="#" class="logo fl"><img th:src="@{/static/img/鸡.png}" alt="..."></a>
    <div class="search_con fl">
        <input type="text" class="input_text fl" placeholder="搜索商品">
        <input type="button" class="input_btn fr" value="搜索">
    </div>
    <div class="guest_card fr">
        <a th:href="@{/cart}" class="card_name fl">我的购物车</a>
        <div class="goods_count fl">
            <span th:text="${session.cartNums}"></span>
        </div>
    </div>
</div>
<!-- 商品信息栏 -->
<div class="navbar_con">
    <div class="navbar clearfix">
        <div class="subnav_con fl">
            <h1>全部商品分类 <i></i></h1>
        </div>
        <ul class="navlist fl">
            <li><a th:href="@{/home}">首页</a></li>
            <li><a href="">手机生鲜</a></li>
            <li><a href="">抽奖</a></li>
        </ul>
    </div>
</div>
<div class="submena clearfix">
    <a href=" ">全部分类</a>
    <span>></span>
    <a href="#" th:text="${goodsInfo.goodsType}"></a>
    <span>></span>
    <a href=" ">商品详情</a>
</div>
<div class="center_con clearfix">
    <div class="main_menu fl">
        <img th:src="${goodsInfo.goodsImg}" alt="...">
    </div>
    <div class="goods_detail_list fr">
        <h3 th:text="${goodsInfo.goodsName}" id="goods_name"></h3>
        <p>草莓浆果柔软多汁，味美爽口，适合速冻保险贮藏，草莓速冻后，可以保持原有的色、香、味，既便于贮藏，又便于外销。</p>
        <div class="prize_bar">
            <div class="show_prize fl">￥<em th:text="${goodsInfo.goodsPrice}" id="single_price"></em></div>
            <div class="show_unit fl">单位：500g</div>
        </div>
        <div class="goods_num clearfix">
            <div class="num_name fl">数量：</div>
            <div class="num_add fl">
                <input type="text" class="num_show fl" id="number" value="1"/>
                <span class="add fr" id="increase">+</span>
                <span class="minus fr" id="decrease">-</span>
<!--                <a type="button" class="minus fr" onclick="reduce()">-</a>-->
            </div>
        </div>
        <div class="total">总价：
            <em th:text="${goodsInfo.goodsPrice}" id="total_price">
            </em> 元
        </div>
        <div class="operate_btn">
            <a href="#" class="buy_btn">立即购买</a>
            <button class="add_cart" onclick="addToCart()">加入购物车</button>
        </div>
    </div>
</div>
<div style="height:300px;overflow-y:auto"></div>
</body>
<script type="text/javascript">

    $(function() {

        // 加元素绑定点击事件
        $("#increase").click(function() {
            var totalPrice = parseInt($("#total_price").text());
            var singlePrice = parseInt($("#single_price").text());
            var num = $(this).siblings("#number").val();
            num++;
            $(this).siblings("#number").val(num);
            $("#total_price").text(totalPrice + singlePrice);
        });
        // 减元素绑定点击事件
        $("#decrease").click(function() {
            var totalPrice = $("#total_price").text();
            var singlePrice = $("#single_price").text();
            var num = $(this).siblings("#number").val();
            if (num == 1) {
                return false;
            }
            num--;
            $(this).siblings("#number").val(num);
            $("#total_price").text(totalPrice - singlePrice);
        });
    });


    function addToCart() {
        console.log("添加函数触发...")
        var gName = $("#goods_name").text();
        var gNums = $("#number").val();

        var goods = {
            goodsName : gName,
            goodsNmb : gNums
        };

        $.ajax({
            url: "/add",
            type: "POST",
            dataType: "json",
            data: JSON.stringify(goods),
            contentType: "application/json; charset=utf-8",
            success: function (result) {
                if(result.code == 100) {
                    alert(result.message);
                    location.reload();
                }else if (result.code == 200) {
                    alert(result.message);
                }
            }
        });
    }
</script>
</html>
